# language_name_wals:	English
# language_name_glotto:	English
# ISO_6393:	eng
# year_composed:	NA
# year_published:	NA
# mode:	written
# genre_broad:	technical
# genre_narrow:	NA
# writing_system:	Latn
# special_characters:	NA
# short_description:	KDE4
# source:	https://object.pouta.csc.fi/OPUS-KDE4/v2/raw/en.zip
# copyright_short:	http://opus.nlpl.eu/KDE4.php
# copyright_long:	http://opus.nlpl.eu/KDE4.php J. Tiedemann, 2012, Parallel Data, Tools and Interfaces in OPUS. In Proceedings of the 8th International Conference on Language Resources and Evaluation (LREC 2012)
# sample_type:	whole
# comments:	NA

The & kappname; Handbook
Wolfgang Rohdewald wolfgang@rohdewald. de
ROLES_OF_TRANSLATORS
This documentation describes the game of & kappname; version & kappversion;
KDE
kdegames
game
kajongg
board
arcade
tile game
tiles
four players
Introduction
Gametype:
Board, Arcade
Number of possible players:
Four
& kajongg; can be used in two different ways: Scoring a manual game where you play as always and use & kajongg; for the computation of scores and for bookkeeping. Or you can use & kajongg; to play against any combination of other human players or computer players.
The Screen Layout
A screenshot of & kajongg;
Screenshot
A quick explanation of the parts of the game screen.
Toolbar
The Toolbar is located beneath the menubar and contains buttons for the most often used actions. The content of the Toolbar can be edited. You can also make it invisible, giving more room to the Board.
Board
The Board is the largest section of the window. You see the four walls with a length of 18 tiles (will eventually be configurable). The names of the players are written on the walls, together with their wind tiles. The prevailing wind has a coloured background, east in the screenshot above.
When scoring manual games, the interior of the walls has a selection of all available tiles, the central selector. You can assign them to the players using the mouse or the keyboard.
Player Region
Every player has a screen range for her tiles. The upper row contains exposed tiles, the lower row concealed tiles. Hidden tiles are shown with a shadow over the entire tile. In the example, Klaus has a hidden pong of stone 9. Bonus tiles go to the right end.
Statusbar
The Statusbar is located at the bottom of the screen and contains the current totals for the players.
Playing Modes
& kajongg; knows two playing modes: scoring a manual game and playing with & kajongg; against people or computer players. In the first mode, you will play Mah Jongg with real tiles on a real table and only use & kajongg; for scoring. If you have enough people at hand to play with this will be your preferred mode. In the second mode you will play only using your computer: either against three computer players or against a mix of remote people and computer players.
Score Manual Game
In this mode, & kajongg; is only used to do the scoring. You play as usual with real people on a real table and at the end of a game you can tell & kajongg; the tiles a player has in her hand and everything else & kajongg; needs to know for calculating the scores - which is what the program will do. Alternatively you can calculate the hand scores manually and enter them. & kajongg; will then make the payments amongst the players and write the results into a data base. It is possible to suspend a game, start another game with other players and resume old games. All rules will be saved together with the games, so different games can be played with different rules.
From the menu, select Game / Score Manual Game or press Ctrl; C.
Now you can either select an existing unfinished game or start a new game. If you start a new game, you will be asked for the players and the ruleset. & kajongg; will propose the same values used for the previous game. If there was no previous game, it will propose the first four defined players. Please note that you cannot change the ruleset or any of its rules after this selection. You can do that beforehand in the ruleset editor.
Now you get a new window titled "Enter the hand results". Read Have kajongg compute the score for a detailed description.
After saving hand results, continue with the next hand.
Play
This lets you play against other players, humans or computers. Read Playing for a detailed description.
Playing
How to start a game
First you will get a login dialog. Enter the game server you wan to connect to and your user name and password. Next you get a list of tables with available seats on that game server. Join a table or allocate a new table. If you allocate a new table, wait until more seats are taken by other players. You can start the game on a table you allocated at any time, the seats not taken will be filled by robot players.
After installation, & kajongg; comes with predefined players "guest 1" to "guest 4" and password = user name. The proposed game server will be localhost (which is your own computer). If you actually connect to localhost, and if the game server process is not yet running, it will automatically be started, and when you leave the program, this local game server will be stopped.
So it is very easy to start playing against the computer.
If you want to play against other people, tell them how they can reach your game server. They need the URL or simply an IP address and the port your server is listening on. This might be something like "mypc. dyndns. org:8149" where 8149 is the port. Of course you need to configure your firewall such that the remote player can reach that port. The communication will be encrypted.
You might prefer to have your game server running constantly, so other people can use it even if & kajongg; is not running on your PC. All you need to do is go to a command line and start the program "kajonggserver". The default value for the port is 8149, you can specify another one using the option "--port PORT".
If you encounter possible bugs, you might want to use the option "--debugtraffic". This will show you, on the console where the server has been started, what messages are flowing between the game server and the clients.
Caveats
It is not yet possible to define accounts on the game server. The accounts "guest 1" to "guest 4" are predefined with passwords equal to the user names. If you want to change that, you currently need to change the database directly, using the shell command "sqlite3 kajongg. db". kajongg. db is probably in the directory $HOME/. kde/ share/ apps/ kajongg. You want to look at the table player.
If you want to make sure nobody can cheat none of the human players should have access to the computer the game server is running on. Of course you can never avoid that two players help each other because you cannot know what they really are doing. Two players might even be one and the same person.
How to play
You will be prompted for what you want to do. This is a little dialog which you can move wherever you want - the next one will appear at the same place. Some dialogs will have a timeout - when it is over, the first possible answer is automatically selected for you. This timeout is configurable in the Ruleset Editor, under Options, Claim Timeout. All players should have the same timeout, that is why this is part of the ruleset.
If you need to select a tile from your hand, you can move between tiles using the right and left arrow keys or the letters h and l on your keyboard.
Often, the dialogs will offer choices which are not really applicable like calling Pung when you do not have the needed tiles. This is intended - just like in a real game.
Discarded tiles are placed randomly between the walls. Some game variants define where the tiles should be placed, this is not yet configurable however. When it becomes configurable, it will be part of the ruleset.
Entering hand results
Scores
This is the window for entering hand results. It automatically shows itself when & kajongg; thinks you might need it. You can always show or hide it by pressing Ctrl; S or by selecting the corresponding menu entry.
As always the prevailing wind has its background colored.
Here you can manually enter scores for all players. Alternatively you can exactly define which tiles a player had in her hand. If you choose to do that, the corresponding field for the manual score value will be grayed out. & kajongg; will automatically compute the score.
After having entered all relevant data for a hand, press the button Save hand. The hand values will be entered in the data base, and they are also entered in the score table. You might be prompted to change the seating positions of the players but you can choose not to change seats. The proposed changes are currently not customizable - if a ruleset needs something different, we will change that.
If the player might have won, the checkbox in the column "Winner" will be enabled - click this for the winner.
The status bar will now show the updated balances for the players, and you can continue with the next hand.
Enter the score manually
A good player will probably prefer to compute her score himself. In that case you can directly enter it. This is only possible when no tiles are selected for this player.
If you enter a manual score, it must already contain everything except penalties, you will have no optional rules to choose from. There is one exception: "Dangerous Game". This does not influence any scores, it is no offense either. It only means the payment between players is different: The offender pays all for all to the winner. The other two players do not exchange payments. This is currently not customizable.
Have & kajongg; compute the score
If you explicitly tell & kajongg; what tiles a player holds, entering scores will be grayed out for that player in this window. While associating tiles with a player you will see how her score will grow - but as soon as you add the 14th tile the score goes to zero. That might surprise you but unless you declare this as the winner hand, it is recognized as a long hand which always has zero points. This behaviour is defined by the Classical Chinese ruleset, it might be different if you change the rules or use a different ruleset.
You can associate tiles and melds with a player using either the mouse or the keyboard or both. With the mouse simply move tiles by dragging/ dropping them to the player region. When dropping the tile, you will be asked what you want to move: Single, Pair, Pung, Kong, Claimed Kong or Chow. The upper row is for exposed tiles, the lower row for concealed tiles. The bonus tiles will appear to the far right. You can also move tiles and melds between rows, between players and back to the central selector.
If you prefer using the keyboard, you can use & Tab; to move between the central selector and the player regions. The keys eswnESWN move a tile to the players East, South, West and North. The keys xX move it back to the central selector. ESWN moves to the concealed row, eswn moves to the exposed row. You can move the cursor between tiles or melds using the arrow keys, the currently selected tile or meld has a blue frame. Since the key arrows are far away from letters on the keyboard, you can also use the letters hjkl or HJKL for moving the cursor. hH move left, jJ move down, kK move up, lL move right. This is how the unix editor "vi" does it. The KDE browser konqueror and even this help program also support those keys in the same way. Those keys may differ if you use a language other than English but it is currently not possible to configure them.
The options "Last Tile" and "Last Meld" are needed by some rules like "last tile completes pair". They can only be used for the winner hand.
In the right part of the window you can manually apply some rules. What rules appear in this list depends on the current ruleset and on the tiles. In the example of the above screen shot, the losing players might have an option "dangerous game" - again depending on the ruleset and on their tiles. It is the aim of the developers to keep this list of manually selectable rules as short as possible. Optimally & kajongg; should always be able to automatically determine whether a rule applies, but sometimes & kajongg; does not have enough information or knowledge to decide.
Penalties
In the window for entering hand results, the Penalties button will bring up this window where you can enter penalties. This can be done at any point in time independent of the normal scoring mechanism.
The offense selection shows all offenses that might be applicable to the hands the players hold. Choose among them.
Now you can adapt the Total Penalty. This is the total sum that is moved from payers to payees. It will be evenly split between them.
Depending on the type of offense, the number of payers and payees varies. The right number of players is displayed. If you select a player, & kajongg; ensures that this player only occurs once by adapting the other players.
Interface Overview
The Game Menu
Game Score Manual Game
Only score a manually played game.
You can load an old game or start a new game. By default only pending (i. e. unfinished) games are shown in the selection list. You can optionally show all games including finished games. Here you can also delete games.
Game Play
Play with others (people and computers)
Game Abort
Abort the current game. When playing, you can only abort when it is your turn.
Game Quit
Quits & kappname;.
The View Menu
View Scoring
Scoring Dialog Show or hide the scoring dialog. This dialog is explained here.
View Score Table
Score Table Score Table Screenshot Show the score table. The leftmost column with the values E, S, W, N shows the player wind. The prevailing wind (the round wind) has a yellowish background. The winner has a green background in the Score column. The∆ column shows how much the player paid to or received from all other players with this hand. The ∑ column shows the balance. The hints give you more details: They show all rules that have been applied to this hand.
The lower part shows the used ruleset. Between the score table and the used rule you can find a splitter letting you change the relative sizes of both parts.
View Explain Scores
Explain Scores Score Table Score Table Explains how the score for the current hand was computed.
The Settings Menu
Settings Players
Add, modify and delete players.
Settings Change Visual Angle
Changes the viewing angle of the tiles counterclockwise.
Settings Full Screen Mode
Switches between full screen mode and normal mode.
Settings Show Toolbar
Shows or hides the Toolbar.
Settings Show Statusbar
Shows or hides the Statusbar.
Settings Configure Shortcuts...
Displays a standard & kde; shortcut configuration dialog for the keyboard shortcuts for & kappname;.
Settings Configure Toolbars...
Displays a standard & kde; dialog where you can configure the toolbar icons.
Settings Configure & kappname;...
Opens a configuration dialog for & kappname;.
The Help Menu
& help. menu. documentation;
Game Configuration
Configure Dialog
Configure Dialog
The menu entry Settings Configure & kappname;... opens the Configure - & kappname; dialog.
If you press the Cancel button here, all of your configuration changes will be reverted, including everything you did with the ruleset editor.
Tiles options
Use the Tiles selector to select graphics for the tiles.
Background options
Background selector
Background selector
Use the Background selector to select a background graphic for the game.
Some backgrounds like the Chinese Landscape need some time to load. If you feel that the program should start faster or that resizing the main window takes too long, you might try some other background.
Ruleset Editor
Ruleset Editor
Ruleset Editor
Use the Ruleset Editor to customize rulesets. Predefined rulesets are shown in an italic font, customized rulesets have a normal font. Predefined rulesets cannot be changed by the user in any way, however an update of & kajongg; might. Customized rulesets will never be affected by an update.
When starting a new game, you will be able to select a ruleset for that game. All rulesets defined in the ruleset editor can be used. The ruleset is saved together with the game, so you can always change rulesets here - your changes will only affect future games.
Copy and Remove
You can copy entire rulesets or single rules within a ruleset. Since predefined rulesets are immutable, single rules can only be copied within customized rulesets.
You can remove entire customized rulesets or single rules within them. Again this can even be done if existing games use this ruleset since every game has its own ruleset copy. You can view rulesets for old games: Load the old game and show its score table.
Name, Score and Unit
Simply double click on whatever you want to change.
Definition
The definition for a rule can be rather complex. There is a separate chapter Defining a Rule for this. You will normally not have to change a definition. This essentially defines to what hands the rule applies.
Default Keybindings
The menu entry Settings Configure Shortcuts... allows you to change the default keyboard bindings.
The default keybindings are as follows:
F1
Displays this handbook.
& Ctrl; C
Score a manual game.
& Ctrl; P
Play a game with other people or computer players.
& Ctrl; W
Abort the current game.
& Ctrl; Q
Quit the program.
& Ctrl; T
Show the score table.
& Ctrl; G
Change the viewing angle.
& Shift; F1
What's this? Help
& Ctrl; Shift; F
Full Screen Mode
Defining a Rule
The scoring engine and many other aspects of & kajongg; can be customized with the ruleset editor. A rule consists of a name, a score (including its unit) and a definition.
Rule Groups
There are several groups of rules:
Meld Rules
Meld rules are applied to single melds independent of the rest of the hand.
Hand Rules
Hand rules are applied to the entire hand, for all players.
Mah Jongg Rules
Mah Jongg rules specify how a winnable hand has to look like. This is normally four melds with 3 or 4 tiles each and a pair. But special hands may look differently, for example the 13 Orphans in Classical Chinese.
Winner Rules
Winner rules are applied to the entire hand but only for the winner. This includes most special hands. Those rules do not have to enforce the correct number of tiles.
Manual Rules
Manual rules are applied manually by the user. We would prefer to live without them but sometimes the program has not yet enough information or is not intelligent enough to automatically apply them when appropriate.
Options
Here you can find several special parameters like points for a limit hand.
Penalties
Penalties are applied manually by the user.
Order of Execution
build a list of applicable rules from meld rules and hand rules
using the Mah Jongg rules find out if the declared winner hand is really a winner hand.
for the winner append applicable winner rules
if some of the found rules have the action'absolute ', only keep those. It is yet undefined what happens if more than one is found.
if some of the rules define limits, throw away all others
apply the found rules in that order
The Definition
The definition is one single string because we want to make it easy to save it in a data base. It consists of several parts separated by the two characters "||". A part expresses either a condition under which the rule applies or it expresses some actions. Only one part for actions may be defined, but several condition expressions. The rule applies as soon as at least one condition expression matches the hand.
& kajongg; comes with a predefined ruleset implementing the Classical Chinese rules as defined by the German DMJL. That should give you a lot of examples.
These are all recognized parts:
Regular Expression
A part not starting with I or A is a Regular Expression.
Variable Case Regular Expression
A part starting with I is a Regular Expression making no difference between upper/ lowercase.
Action
A part starting with A is a list of Actions.
Regular Expressions
Regular expressions are a very powerful programming tool for matching strings of characters. Powerful but also quite difficult. This is not for the normal game player. There are books available which do nothing else but explain regular expressions.
There are several dialects of regular expressions. & kajongg; is written in the programming language Python. Since the Python standard library contains a module for regular expressions, this is the dialect we use. For details see
Everything about a hand that might have an influence on the score is encoded in one single string. Then & kajongg; checks if the regular expression matches this string. If it does, the rule is applied.
As an example, this regular expression matches the limit hand "All Greens":
(|[bB][23468]|[dD]g)*[fy/]
Structure of a Hand String
The content of a hand string is always the same no matter what language you use on your desktop.
The string representing a hand consists of several parts separated by a space. The order of those parts is always the same except for the meld parts at the beginning.
& kajongg; is able to regroup concealed tiles into melds aiming to get a higher score. It does not matter how the concealed tiles are grouped for this to work. However when it comes to limit hands this might fail. That is why & kajongg; will try the original grouping of tiles as entered by the user and also the regrouped tiles. For both variants, all rules are applied. The variant achieving the higher total score is used.
Here comes an example. This is really only one line but split here for better readability. Moreover this sentence is repeated once because some regular expressions are much easier to write if the parts can be referenced in another order. See the rule for Robbing the Kong: Its regular expression first looks at the L group (Last Tile) before looking at the melds.
c1c1c1C1 s1s2s3 b6b6b7b7b8b8 b5b5 fn yn / c416s000b000b000b200 -C416s000b000b000b200 %n Mneka LB5B5B5
A tile is represented by 2 characters. The first one is s for stone, b for bamboo, c for character, w for wind, d for dragon, y for season bonus, f for flower bonus. The second one is 1..9 for the suits, e, s, w, n for the winds, w, r, g for the dragons (white, red, green) and 1,2,3,4 for the bonus tiles. Exposed tiles have the first character in lowercase, concealed tiles have it in uppercase.
All the following parts are always present in this order except the part "Last Tile": This one exists only for the winner hand.
Meld
The part starting with any of the characters sbcdwSBCDW is a meld. A meld holds any number of tiles. & kajongg; will split melds with too many tiles trying to maximize the score.
We use a special syntax for kongs: c1c1c1c1 is an open kong. c1c1c1C1 is an open kong, 4th tile was called for, completing a concealed pung. This is needed for the limit game'concealed true color game '. c1C1C1c1 is a concealed declared kong. C1C1C1C1 would be a concealed undeclared kong. But since it is undeclared, it is counted as a pung. So this meld will be split into pung C1C1C1 and single C1.
Bonus tiles appear after all other melds.
Summary
The part starting with / holds summary information about the melds. This makes it easier to write some regular expressions. Every meld is represented by four characters. The first character is one out of sbcdwSBCDW, again lowercase for exposed and uppercase for concealed. The second character is a number saying how many tiles the meld holds. This is 1 up to 4 for a kong. The 0 is used for a chow. The last two characters hold the value of this meld.
Alternate summary
The part starting with - is identical to the above summary but it contains claimed kongs as concealed kongs. Some rules like "Three Concealed Pongs" treat a claimed kong as being concealed.
Hand length
The part starting with% holds information about the length of the hand: s is a short hand having too few tiles, n is a hand with the correct number of tiles, l is a long hand having too many tiles.
Mah Jongg
The part starting with m or M holds additional information. M stands for the winner hand, m for a loser hand. M/ m is followed by one character for the own wind, one character for the prevailing wind, one character for the source of the last tile leading to Mah Jongg, one character for the declarations a player made.
These are the possible sources of the last tile: w=wall, d=discarded, e=dead end, z=last tile of living end, Z=last tile of living end, discarded, k=robbing the kong, 1=blessing of heaven/ earth. The values w and d are special - they are sort of intermediate values. By choosing a concealed tile as last tile, the source is set to w. Next, several rules say that they apply only if the last tile comes from the wall. So this allows for a better preselection of actually applicable manual rules. For a better understanding, please look at the manual rules and read up about the action lastsource.
These are the possible declarations: a=call at beginning.
Last Tile
The part starting with L holds information about the last tile. It contains the last tile itself, followed by the meld that was completed with the last tile. We need this last meld for the rule "Last Tile is the Only Possible" because sometimes knowing only the last tile is not sufficient. Note that the last meld cannot be a Kong because if it completes a Kong you have to draw a replacement tile.
Calling Limit Hand
This is not yet implemented but might be needed for rules like defined by the BMJA (in England). A part starting with K holds all possible tiles to be checked for if we give points for a calling limit hand. We could use brute force and check with every tile but that might take too much time.
Actions
All actions for a rule are defined in one string. They are separated by spaces. Some of them define a value.
payforall
The player did something very nasty, so she must pay for all. Yet this is not a penalty since the sum of payments is the same - only the payer changes. Also, the two payers not involved do not exchange payments.
payers=X
Defines how many payers this penalty rule implies. X is a number.
payees=X
Defines how many payees this penalty rule implies. X is a number.
absolute
This action defines an absolute payment. The hand score is ignored. Used for penalty rules.
lastsource
This action defines the source of the last tile. Used by manual rules like "last tile from dead end". Setting the last source with this action serves as a filter for other rules - if they trigger only for certain sources. Those other rules can of course also be manual rules. So this filtering will narrow down the amount of manual rules the user gets shown in the scoring dialog. If this seems complicated, just play around with the scoring dialog and watch checkboxes appear and disappear depending on the source of the last tile.
Known problems
It is not yet possible for the player herself to open an account on the game server.
In playing mode, penalties are not yet possible.
The computer players are still rather stupid.
The names of the computer players are not yet customizable.
Computer games cannot yet be resumed.
Possible future features
Add more rulesets. This should optionally be done by people using those rulesets regularly.
Add sounds. The calls "Chow" & etc; should be played, also what tiles are discarded. Define standard sounds, but also make it possible for the player to record her own voice.
Frequently asked questions
I want to change the way this game looks. Can I?
Yes. To change the way & kappname; looks use the menubar to open the configuration utility.
Can I use the keyboard to assign tiles to players?
Yes. See Have kajongg compute the score
I mailed a bug or wish, but it was never received
If you did that with Help Report Bug...: You need to configure a mail server. Start the program System Settings, select Personal / About Me and define the SMTP Server. If this field is empty, mailing will silently fail. I cannot change this behaviour. (This would work without a defined SMTP server if I had a xxx@kde. org mailing address but currently I do not)
Credits and License
& kappname; for & kde;
Program Copyright & copy; 2009 Wolfgang Rohdewald wolfgang@rohdewald. de
Documentation Copyright & copy; 2009 Wolfgang Rohdewald wolfgang@rohdewald. de
CREDIT_FOR_TRANSLATORS
& underFDL; & underGPL;
Installation
Use the. deb package from. If it does not work for you, you can download kajongg-x-y. tar. gz from the same address and then do:
tar xfz kajongg-x-y. tar. gz cd kajongg-x-y. / setup. py install
In both cases you will manually have to make sure that some other required packages are installed. The debian package does not yet contain these requirements. & kajongg; needs: (corresponding debian packages in parentheses)
the KDE4 games library (libkdegames5)
Python 2.5 or higher (python)
QT4.4 or higher (libqt4-core, libqt4-gui, libqt4-svg, libqt4-sql, libqt4-sql-sqlite)
the python bindings for QT4 (python-qt4, python-qt4-sql)
the python bindings for KDE4 (python-kde4)
the python twisted library (python-twisted-core)
sqlite3 (libsqlite3-0)
kajongg
In this mode, & kajongg; is only used to do the scoring.
Play Local Game
This mode is not yet implemented.
Play Network Game
Game Play Local Game
A local game: You against 3 computer players. Not yet implemented.
Game Play Network Game
The Play Menu
& Ctrl; L
Play a local game.
& Ctrl; N
Play a network game.
Winner rules are applied to the entire hand but only for the winner.
Numbers
Strings
Strings are several special parameters - none yet defined.
Play against the computer like xmj does.
Play over the net with other players. Use the ggz framework, see
Here comes an example. This is really only one line but split here for better readability.
These are the possible sources of the last tile: e=dead end, z=last tile of living end, Z=last tile of living end, discarded, k=robbing the kong, 1=blessing of heaven/ earth
Ctrl; + Shift; F
Table
Starts a new game.
Loads a saved game.
Opens a dialog to configure & kappname;. For details, see here.
General options
Tiles selector
Tile selector
Tiles selector
Background selector
Keybindings Configure Dialog
Keybindings Configure Dialog
Starts a new game.
& Ctrl; A
Single
Enter the players, if & kajongg; does not yet know about them: Settings Players
& Ctrl; H