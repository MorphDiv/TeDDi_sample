---
title: "100LC Unigram Entropy Figures"
author: "Chris Bentz"
date: "May 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This file generates some figures to visualize the relationship between unigram entropy of characters and orthographic words across the languages and texts of the 100LC.

##Load Libraries
If libraries are not yet installed, use install.packages("package-name") to install them.
```{r}
library(ggplot2)
library(gridExtra)
library(gsubfn)
library(ggrepel)
```

## Load Entropy Data
Read files.
```{r}
words <- read.csv("/home/chris/Data/100LC/Texts/Entropy/unigramH_words.csv", header = T)
head(words)
chars <- read.csv("/home/chris/Data/100LC/Texts/Entropy/unigramH_chars.csv", header = T)
head(chars)
```

Combine character entropies and word entropies in one data frame.
```{r}
H.df <- cbind(words, chars$H.chars)
colnames(H.df)[5] <- "H.chars"
head(H.df)
```

## Add Meta Data
Get relevant meta data from the raw text file headers.
```{r}
meta.df <- data.frame(matrix(ncol = 6, nrow = 0)) #initialize data frame
colnames(meta.df) <- c("lang.name.wals", "lang.name.glotto", "mode", "genre.broad", "genre.narrow", "script")

for (file.name in H.df$file.name){
  file.path <- paste("/home/chris/Data/100LC/Texts/Raw/", file.name, sep ="")
  header <- scan(file.path, what = "char", sep = "\n", encoding = "UTF-8", n = 16)
  header <- gsubfn(".", list("#" = "", " " = "", "\t" = ""), header) # remove unnecessary white spaces, "#", and tabs from header.
  lang.name.wals <- gsub(".*:", "", header[1])
  lang.name.glotto <- gsub(".*:", "", header[2])
  mode <- gsub(".*:", "", header[6])
  genre.broad <- gsub(".*:", "", header[7])
  genre.narrow <- gsub(".*:", "", header[8])
  script <- gsub(".*:", "", header[9])
  meta.df.new <- data.frame(lang.name.wals, lang.name.glotto, mode, genre.broad, genre.narrow, script)
  meta.df <- rbind(meta.df, meta.df.new)
}
head(meta.df)
```

Add this meta data to the entropy data frame.
```{r}
H.df <- cbind(H.df, meta.df)
head(H.df)
```

## FIGURES
```{r, fig.width = 10, fig.height = 5}
H.df$label <- H.df$lang.name.wals
H.df[H.df$iso != "rus", ]$label <- ""

fig.H <- ggplot(H.df, aes(x = H.chars, y = H.words, size = num.tokens, colour = mode)) +
  labs(x = "Character Entropy", y = "Orthographic Word Entropy") +
  theme(legend.position = "bottom") +
  geom_label_repel(aes(label = label),
                  box.padding   = 0.35, 
                  point.padding = 0.5,
                  size = 4,
                  segment.color = 'grey50') +
  geom_point()
print(fig.H)
```

```{r, fig.width = 10, fig.height = 5}
ggsave("Figures/figure_H", fig.H , dpi = 300, scale = 1, device = cairo_pdf)
```